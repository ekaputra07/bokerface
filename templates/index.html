{% extends 'base.html' %}

{% block title %}Boker Face â€¢ ini expresi gue, mana expresi loe{% endblock %}

{% block content %}
<div id='center' class='span6'>
  <div class='alert alert-warning welcome'>
    <h1>Boker Face</h1>
    Ga harus perfect untuk bisa menjadi star idol, Kamu pun bisa. Ini expresi BF gue, mana expresi BF loe?
  </div>
  <div class='row'>
    <ul class='thumbnails' id="bokers-container">
    </ul>
    <div class="loading hide"><img src="{{STATIC_URL}}assets/img/loading.gif"/></div>
  </div>
</div>
{% endblock %}

{% block footerscript %}
    <script type="text/template" id="boker_template">
        <li class='span6'>
          <div class='outer'>
          <div class='view view-thumb thumbnail'>
              <img src='/images/<%= obj.photo.key %>' alt='<%= obj.description %>'>
              <a href='<%= obj.permalink %>'>
                <div class='mask'>
                  <span class='keyhole'></span>
                  <span class='label label-important icon stat-info'><i class='icon-star icon-white'></i> 123 <i class='icon-thumbs-up icon-white'></i> 123 <i class='icon-comment icon-white'></i> 12</span>
                </div>
              </a>
          </div>
          <p><span class='label label-inverse'><%= obj.user.username %></span> <%= obj.description %></p>
          </div>
          <div class='sidebox ft'>
            <a href='<%= obj.user.url %>'><img class='avatar' src='http://graph.facebook.com/<%= obj.user.id %>/picture?type=square' alt='theheartdirector' /></a>
            <%= obj.is_new %> <span><i class='icon-time'></i> <%= obj.created %></span>
          </div>
        </li>
    </script>

    <script type="text/javascript">

        var BokersView = Backbone.View.extend({
            el: '#bokers-container',
            initialize: function(){
                _.bindAll(this, 'render_item', 'fetch_data');
                this.template = _.template($('#boker_template').html());

                this.bokers = new Posts([], {});
                this.bokers.bind('add', this.render_item, this);
                this.loading = false;
            },
            render_item: function(boker){
                this.$el.append(this.template({obj: boker.toJSON()}));
                return this;
            },

            fetch_data: function(){
                var that = this;

                this.loading = true;
                $('.loading').show();
                this.bokers.fetch({
                    update: true,
                    success: function(){
                        that.loading = false;
                        $('.loading').hide();
                    }
                });
            }
        });

        jQuery(document).ready(function($){
            var bokers_list = new BokersView;
            bokers_list.fetch_data();

            $(window).scroll(function(){
                if(bokers_list.loading==false){
                    var closeToBottom = ($(window).scrollTop() + $(window).height() > $(document).height() - 100);
                    if(closeToBottom) {
                        if(bokers_list.bokers.next_url){
                            bokers_list.bokers.url = bokers_list.bokers.next_url;
                            bokers_list.fetch_data();
                        }
                    } 
                }
            });
        });
    </script>
{% endblock %}

